<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Palm Detection with Animation</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
  <style>
    body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: #111; }
    canvas { position: absolute; top: 0; left: 0; }
    video { display: none; }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>

  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    let model, palmDetected = false, detectionStart = null, showTick = false;
    let rotation = 0;

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { exact: "environment" }, width: 640, height: 480 }
      });
      video.srcObject = stream;
      return new Promise(resolve => {
        video.onloadedmetadata = () => resolve(video);
      });
    }

    async function detectHands() {
      const predictions = await model.estimateHands(video, true);

      if (predictions.length > 0) {
        // Palm detected
        if (!palmDetected) {
          palmDetected = true;
          detectionStart = Date.now();
          showTick = false;
        } else if (Date.now() - detectionStart > 2000) {
          showTick = true;
        }
      } else {
        // No palm, reset
        palmDetected = false;
        detectionStart = null;
        showTick = false;
      }
    }

    function drawAnimation() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (palmDetected) {
        const x = canvas.width / 2;
        const y = canvas.height / 2;

        // Rotating circle
        rotation += 0.05;
        ctx.beginPath();
        ctx.arc(x, y, 80, 0, Math.PI * 2);
        ctx.strokeStyle = "cyan";
        ctx.lineWidth = 4;
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(x, y, 80, rotation, rotation + Math.PI / 2);
        ctx.strokeStyle = "lime";
        ctx.lineWidth = 6;
        ctx.stroke();

        // Show tick after 2 seconds
        if (showTick) {
          ctx.font = "80px Arial";
          ctx.fillStyle = "lime";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText("âœ”", x, y);
        }
      }
    }

    async function main() {
      await setupCamera();
      video.play();
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      model = await handpose.load();

      async function loop() {
        await detectHands();
        drawAnimation();
        requestAnimationFrame(loop);
      }
      loop();
    }

    main();
  </script>
</body>
</html>
