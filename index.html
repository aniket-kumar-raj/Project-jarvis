<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bluetooth Palm Sender</title>
</head>
<body>
  <h2>Image Viewer + Palm Detection</h2>
  <img id="viewer" src="pic1.jpg" width="300"><br><br>
  <button onclick="nextImage()">Next Image</button>
  <button onclick="connectBluetooth()">ðŸ”— Connect Bluetooth</button>

  <script>
    let images = ["pic1.jpg", "pic2.jpg", "pic3.jpg"];
    let codes = ["pic1", "pic2", "pic3"];
    let index = 0;
    let device, server, service, characteristic;

    function nextImage() {
      index = (index + 1) % images.length;
      document.getElementById("viewer").src = images[index];
    }

    async function connectBluetooth() {
      try {
        device = await navigator.bluetooth.requestDevice({
          acceptAllDevices: true,
          optionalServices: ['12345678-1234-5678-1234-56789abcdef0'] // custom UUID
        });
        server = await device.gatt.connect();
        service = await server.getPrimaryService('12345678-1234-5678-1234-56789abcdef0');
        characteristic = await service.getCharacteristic('12345678-1234-5678-1234-56789abcdef1');
        alert("Connected!");
      } catch (e) {
        alert("Error: " + e);
      }
    }

    async function sendImageCode() {
      if (!characteristic) return alert("Not connected!");
      let code = codes[index];
      let encoder = new TextEncoder();
      await characteristic.writeValue(encoder.encode(code));
      alert("Sent: " + code);
    }

    // ðŸ‘‰ Replace this with palm detection trigger
    setInterval(() => {
      // Simulate palm detected for 2 sec
      if (Math.random() > 0.95) {
        sendImageCode();
      }
    }, 2000);
  </script>
</body>
</html>
