<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sender Gallery</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: black;
      overflow: hidden;
      position: relative;
    }

    /* GALLERY SLIDER */
    .gallery-wrapper {
      height: 100%;
      width: 100%;
      overflow: hidden;
      position: relative;
    }

    .gallery {
      display: flex;
      height: 100%;
      width: 100%;
      transition: transform 0.4s ease;
    }

    .gallery img {
      min-width: 100%;
      height: 100%;
      object-fit: contain;
      background: black;
    }

    /* INDICATORS */
    .indicator {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
    }
    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: gray;
    }
    .dot.active {
      background: white;
    }

    /* OVERLAY ANIMATIONS */
    .overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      flex-direction: column;
      align-items: center;
      color: white;
    }
    .spinner {
      border: 5px solid rgba(255,255,255,0.2);
      border-top: 5px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0); }
      to { transform: rotate(360deg); }
    }
    .tick {
      font-size: 50px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="gallery-wrapper">
    <div class="gallery" id="gallery">
      <img src="pic1.jpg" alt="pic1">
      <img src="pic2.jpg" alt="pic2">
      <img src="pic3.jpg" alt="pic3">
    </div>
    <div class="indicator" id="indicator"></div>
  </div>

  <div class="overlay" id="overlay">
    <div class="spinner" id="spinner"></div>
    <div class="tick" id="tick">âœ”</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDrZDZ_M_DC97zLxLw4hgxwm_revSjwkMA",
      authDomain: "project-jarvis-creators.firebaseapp.com",
      databaseURL: "https://project-jarvis-creators-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "project-jarvis-creators",
      storageBucket: "project-jarvis-creators.firebasestorage.app",
      messagingSenderId: "489774215647",
      appId: "1:489774215647:web:496a71ec5b210c6aa6d46a",
      measurementId: "G-P6ZFBKM2RR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Gallery
    const gallery = document.getElementById("gallery");
    const indicator = document.getElementById("indicator");
    const total = gallery.children.length;
    let current = 0;
    let startX = 0;
    let isDragging = false;

    // preload images
    [...gallery.children].forEach(img => {
      const preload = new Image();
      preload.src = img.src;
    });

    // indicators
    for (let i = 0; i < total; i++) {
      const dot = document.createElement("div");
      dot.className = "dot" + (i === 0 ? " active" : "");
      indicator.appendChild(dot);
    }
    function updateIndicator() {
      [...indicator.children].forEach((d, i) => {
        d.classList.toggle("active", i === current);
      });
    }
    function updateGallery() {
      gallery.style.transform = `translateX(-${current * 100}%)`;
      updateIndicator();
    }

    // swipe events
    gallery.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
      isDragging = true;
    });
    gallery.addEventListener("touchend", e => {
      if (!isDragging) return;
      const endX = e.changedTouches[0].clientX;
      if (endX - startX > 50 && current > 0) current--;
      if (startX - endX > 50 && current < total - 1) current++;
      updateGallery();
      isDragging = false;
    });

    // Overlay
    const overlay = document.getElementById("overlay");
    const spinner = document.getElementById("spinner");
    const tick = document.getElementById("tick");

    function sendCurrentPic() {
      const picCode = "pic" + (current + 1);
      set(ref(db, "gallery/selected"), picCode);
    }

    // Fake palm detection
    function triggerPalm() {
      overlay.style.display = "flex";
      spinner.style.display = "block";
      tick.style.display = "none";

      setTimeout(() => {
        spinner.style.display = "none";
        tick.style.display = "block";
        sendCurrentPic();

        setTimeout(() => {
          overlay.style.display = "none";
        }, 1500);
      }, 2000);
    }

    // Demo auto palm every 6s
    setInterval(triggerPalm, 6000);

    updateGallery();
  </script>
</body>
</html>
