<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bluetooth Code Word Sender/Receiver</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        #status { margin-bottom: 1em; }
        .section { margin-bottom: 2em; }
        label { margin-right: 1em; }
    </style>
</head>
<body>
    <h1>Bluetooth Code Word Sender/Receiver</h1>
    <div id="status">Status: Not connected</div>
    <div class="section">
        <button id="connect">Connect Bluetooth Device</button>
    </div>
    <div class="section">
        <label for="codeword">Send Code Word:</label>
        <input type="text" id="codeword" placeholder="Enter code word">
        <button id="send">Send</button>
    </div>
    <div class="section">
        <h3>Received Code Word:</h3>
        <div id="received"></div>
    </div>
    <script>
        let bluetoothDevice;
        let codewordCharacteristic;

        // UUIDs for service and characteristic (replace with your device's UUIDs if needed)
        const SERVICE_UUID = '0000ffe0-0000-1000-8000-00805f9b34fb'; // Generic UART service
        const CHARACTERISTIC_UUID = '0000ffe1-0000-1000-8000-00805f9b34fb'; // UART RX/TX

        document.getElementById('connect').onclick = async function() {
            try {
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ services: [SERVICE_UUID] }]
                });
                const server = await bluetoothDevice.gatt.connect();
                const service = await server.getPrimaryService(SERVICE_UUID);
                codewordCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);

                // Listen for incoming code words
                await codewordCharacteristic.startNotifications();
                codewordCharacteristic.addEventListener('characteristicvaluechanged', event => {
                    const value = event.target.value;
                    const decoder = new TextDecoder('utf-8');
                    const receivedWord = decoder.decode(value);
                    document.getElementById('received').textContent = receivedWord;
                });

                document.getElementById('status').textContent = 'Status: Connected';
            } catch (error) {
                document.getElementById('status').textContent = 'Status: ' + error;
            }
        };

        document.getElementById('send').onclick = async function() {
            const word = document.getElementById('codeword').value;
            if (!codewordCharacteristic) {
                alert('Connect to a Bluetooth device first.');
                return;
            }
            if (!word) {
                alert('Enter a code word to send.');
                return;
            }
            const encoder = new TextEncoder();
            const data = encoder.encode(word);
            try {
                await codewordCharacteristic.writeValue(data);
                document.getElementById('status').textContent = 'Status: Code word sent!';
            } catch (error) {
                document.getElementById('status').textContent = 'Status: ' + error;
            }
        };
    </script>
</body>
</html>
