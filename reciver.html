<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultra Lightweight Palm Detector</title>
<style>
  body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; overflow:hidden; font-family:Arial,sans-serif; position:relative; }
  #display { max-width:100%; max-height:100%; opacity:0; transition:opacity 0.3s linear; }
  #overlay {
    position:absolute; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center;
    color:white; font-size:18px; text-align:center; background:rgba(0,0,0,0.85); opacity:1; transition:opacity 0.3s;
  }
  video { display:none; }
</style>
</head>
<body>
<video id="camera" autoplay playsinline width="80" height="60"></video>
<img id="display" src="">
<div id="overlay">Please show your palm</div>

<script type="module">
const video = document.getElementById("camera");
const img = document.getElementById("display");
const overlay = document.getElementById("overlay");

const mapping = { "pic1":"https://lab4u.tech/pic1.jpg","pic2":"https://lab4u.tech/pic2.jpg","pic3":"https://lab4u.tech/pic3.jpg" };
let latestCode = "pic1";

const canvas = document.createElement("canvas");
canvas.width = 80;
canvas.height = 60;
const ctx = canvas.getContext("2d");
let lastFrame = null;

let imageVisible = false;      // state to avoid flicker
let lastMotionTime = 0;
const showDuration = 1000;     // show image for at least 1 sec

navigator.mediaDevices.getUserMedia({ video: true }).then(stream => { video.srcObject = stream; });

function showImage(code){
  const newSrc = mapping[code];
  if(img.src !== newSrc) img.src = newSrc;
  if(!imageVisible){
    img.style.opacity = 1;
    overlay.style.opacity = 0;
    imageVisible = true;
  }
}

function hideImage(){
  if(imageVisible){
    img.style.opacity = 0;
    overlay.style.opacity = 1;
    imageVisible = false;
  }
}

function detectMotion(){
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const frame = ctx.getImageData(0,0,canvas.width,canvas.height);
  
  if(lastFrame){
    let diff = 0;
    for(let i=0;i<frame.data.length;i+=4){
      diff += Math.abs(frame.data[i]-lastFrame.data[i]);
    }
    const now = Date.now();
    if(diff > 10000){ // motion threshold
      lastMotionTime = now;
      showImage(latestCode);
    } else if(now - lastMotionTime > showDuration){
      hideImage();
    }
  }
  lastFrame = frame;
  requestAnimationFrame(detectMotion);
}

video.onloadeddata = ()=>{ detectMotion(); };
</script>
</body>
</html>
